<html>
	<head>
		<title>Flashback: the Quest for Identity - DPoly.js</title>
	</head>
	<body>
		<div align="center">
		<h2>Flashback: the Quest for Identity - DPoly.js</h2>
		<div style="width: 480px;">
			<canvas id="screen" width="480" height="256"></canvas>
			<div align="right">
				<select onclick="onSelect()" id="nameSelect">
					<option>chute</option>
					<option>debut</option>
					<option>desinteg</option>
					<option>espions</option>
					<option>holocube</option>
					<option>intro</option>
					<option>logos</option>
					<option>memo</option>
					<option>taxi</option>
					<option>voyage</option>
				</select>
				<input type="button" value="Play" onclick="onPlay()" id="playButton" />
			</div>
		</div>
		<audio id="music"></audio>
		<script type="text/javascript" src="dpoly.min.js"></script>
		<script type="text/javascript">
			var CUTSCENES = [
				{ data : "chute.cmp.txt",    music : "chute.ogg",    offset : 1 },
				{ data : "debut.cmp.txt",    music : "debut.ogg",    offset : 0 },
				{ data : "desinteg.cmp.txt", music : "desinteg.ogg", offset : 0 },
				{ data : "espions.cmp.txt",  music : "reunion.ogg",  offset : 0 },
				{ data : "holoseq.cmp.txt",  music : "memoire.ogg",  offset : 0 },
				{ data : "intro.cmp.txt",    music : "intro.ogg",    offset : 0 },
				{ data : "logos.cmp.txt",    music : "logo.ogg",     offset : 0 },
				{ data : "memo.cmp.txt",     music : "memoire.ogg",  offset : 0 },
				{ data : "taxi.cmp.txt",     music : "taxi.ogg",     offset : 0 },
				{ data : "voyage.cmp.txt",   music : "voyage.ogg",   offset : 0 }
			];
			var cutscene = 5;

			nameSelect.selectedIndex = cutscene;

			player.init( "screen" );
			playCutscene( );

			function playCutscene( ) {
				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function() {
					if ( xhr.readyState == 4 && xhr.status == 200 ) {
						player.decode( atob( xhr.responseText ) );
						player.start( CUTSCENES[ cutscene ].offset );
						music.src = "music/" + CUTSCENES[ cutscene ].music;
						music.play( );
					}
				}
				xhr.open("GET", "cine/" + CUTSCENES[ cutscene ].data, true);
				xhr.send();
			}

			function onSelect( ) {
				cutscene = nameSelect.selectedIndex;
				playCutscene(  );
			}

			function onPlay() {
				player.start( CUTSCENES[ cutscene ].offset );
				music.src = "music/" + CUTSCENES[ cutscene ].music;
				music.play( );
			}
		</script>
		</div>
	</body>
</html>
