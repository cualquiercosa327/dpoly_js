<html>
	<head>
		<title>Flashback: the Quest for Identity - DPoly.js</title>
	</head>
	<body>
		<div align="center">
		<h1>Flashback: the Quest for Identity - DPoly.js</h1>
		<div style="width: 480px;">
			<canvas id="screen" width="480" height="256"></canvas>
			<div align="left">
				<input type="button" value="Play" onclick="onPlay()" id="playButton" />
			</div>
		</div>
		<audio id="music"></audio>
		<script type="text/javascript" src="decode.js"></script>
		<script type="text/javascript" src="player.js"></script>
<!--
		<script type="text/javascript" src="dpoly.min.js"></script>
-->
		<script type="text/javascript">
			var CUTSCENES = [
				{ data : "debut.cmp.txt",   music : "debut.ogg",   offset : 2 },
				{ data : "espions.cmp.txt", muisc : "reunion.ogg", offset : 2 },
				{ data : "intro.cmp.txt",   music : "intro.ogg",   offset : 2 },
				{ data : "logos.cmp.txt",   music : "logo.ogg",    offset : 2 },
				{ data : "taxi.cmp.txt",    music : "taxi.ogg",    offset : 2 },
				{ data : "voyage.cmp.txt",  music : "voyage.ogg",  offset : 2 }
			];
			var NUM = 2;

			player.init( "screen" );

			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function() {
				if ( xhr.readyState == 4 && xhr.status == 200 ) {
					player.decode( atob( xhr.responseText ) );
					player.start( CUTSCENES[ NUM ].offset );
					music.src = "music/" + CUTSCENES[ NUM ].music;
					music.play( );
				}
			}
			xhr.open("GET", "cine/" + CUTSCENES[ NUM ].data, true);
			xhr.send();

			function onPlay() {
				player.start( CUTSCENES[ NUM ].offset );
				music.src = "music/" + CUTSCENES[ NUM ].music;
				music.play( );
			}
		</script>
		</div>
	</body>
</html>
